= Migration Guide
:navtitle: Migration Guide

This guide helps you migrate between major versions of Redis OM Spring.

== Upgrading to 2.0.0 (Spring Boot 4.0.0)

Redis OM Spring 2.0.0 is a major version upgrade that brings support for Spring Boot 4.0.0 and its ecosystem.

=== Dependency Changes

[cols="1,1,1"]
|===
|Dependency |Previous Version |New Version

|Spring Boot
|3.5.8
|4.0.0

|Spring Data Redis
|3.5.6
|4.0.0

|Spring Framework
|6.2.x
|7.0.x

|Jedis
|6.0.0
|7.0.0

|Java
|17+
|21+ (required)
|===

=== Breaking Changes

==== Java 21 Required

**Impact:** All users.

Spring Boot 4.0 requires Java 21 as the minimum version. You must upgrade your JDK to Java 21 or later.

**Migration Steps:**

. Install Java 21 (e.g., from https://adoptium.net/[Eclipse Temurin] or your preferred JDK distribution)
. Update your build configuration:
+
.Maven (pom.xml)
[source,xml]
----
<properties>
    <java.version>21</java.version>
</properties>
----
+
.Gradle (build.gradle)
[source,groovy]
----
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}
----

==== Spring Boot 4.0 Modularization

**Impact:** Users with test dependencies or custom auto-configuration.

Spring Boot 4.0 has reorganized packages to improve modularity. Several test-related classes have moved to new modules.

**Migration Steps:**

If you use any of the following in your tests, update your imports and add the appropriate test dependencies:

.AutoConfigureMockMvc
[source,java]
----
// Before (3.x)
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;

// After (4.0)
import org.springframework.boot.webmvc.test.autoconfigure.AutoConfigureMockMvc;
----

Add test dependency:
[source,xml]
----
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-webmvc-test</artifactId>
    <scope>test</scope>
</dependency>
----

.TestRestTemplate
[source,java]
----
// Before (3.x)
import org.springframework.boot.test.web.client.TestRestTemplate;

// After (4.0)
import org.springframework.boot.resttestclient.TestRestTemplate;
----

Add test dependency:
[source,xml]
----
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-resttestclient</artifactId>
    <scope>test</scope>
</dependency>
----

.DataRedisAutoConfiguration
[source,java]
----
// Before (3.x)
import org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration;

// After (4.0)
import org.springframework.boot.data.redis.autoconfigure.DataRedisAutoConfiguration;
----

Add dependency if needed:
[source,xml]
----
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-data-redis</artifactId>
</dependency>
----

==== Repository Auto-Configuration Changes

**Impact:** Users with multiple Redis repository configurations or custom auto-configuration exclusions.

Spring Boot 4.0's auto-configuration for Redis repositories is more aggressive and may create conflicting beans if you're using custom repository configurations.

**Migration Steps:**

If you encounter bean definition conflicts, exclude the auto-configuration:

[source,java]
----
import org.springframework.boot.data.redis.autoconfigure.DataRedisRepositoriesAutoConfiguration;

@SpringBootApplication(
    exclude = DataRedisRepositoriesAutoConfiguration.class
)
public class MyApplication {
    // ...
}
----

=== Testing Your Migration

After upgrading, ensure you test:

. All repository methods and queries
. Custom auto-configuration classes
. Integration tests, especially those using TestContainers
. Any direct usage of Spring Data Redis or Jedis APIs

=== Additional Resources

* https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-4.0-Release-Notes[Spring Boot 4.0 Release Notes]
* https://github.com/spring-projects/spring-data-redis/wiki/Spring-Data-Redis-4.0-Release-Notes[Spring Data Redis 4.0 Release Notes]
* https://github.com/redis/jedis/releases/tag/v7.0.0[Jedis 7.0.0 Release Notes]

== Upgrading to 1.1.0 (Spring Boot 3.5.x)

Redis OM Spring 1.1.0 introduces support for Spring Boot 3.5.x and includes important dependency upgrades.

=== Dependency Changes

[cols="1,1,1"]
|===
|Dependency |Previous Version |New Version

|Spring Boot
|3.4.x
|3.5.8

|Spring Data Redis
|3.4.x
|3.5.6

|Jedis
|5.2.0
|6.0.0
|===

=== Breaking Changes

==== Annotation Processing with Java 23+ (including Java 25)

When upgrading to **Java 23 or newer (e.g. Java 25)**, note that the Java compiler (`javac`) no longer runs annotation processors found on the classpath **by default**.

This change affects **Redis OM Spring metamodel generation** (the generated classes ending with `$`, used by `EntityStream` APIs).  
With **Java 21 and earlier**, these classes were generated automatically without any additional build configuration.

Starting with **Java 23+**, annotation processing must be **explicitly enabled** in the build.  
Otherwise, metamodel classes will not be generated and compilation errors referencing missing `$` classes may occur.

### Maven example

```xml
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-compiler-plugin</artifactId>
  <configuration>
    <compilerArgs>
      <arg>-proc:full</arg>
    </compilerArgs>
    <annotationProcessorPaths>
      <path>
        <groupId>com.redis.om</groupId>
        <artifactId>redis-om-spring</artifactId>
        <version>${redis.om.spring.version}</version>
      </path>
    </annotationProcessorPaths>
  </configuration>
</plugin>
```

### Gradle example

```
tasks.withType(JavaCompile).configureEach {
    options.compilerArgs += "-proc:full"
}
```

==== Jedis 6.0.0 Query Escaping

**Impact:** Users writing custom RediSearch queries using Jedis directly.

Jedis 6.0.0 changed how it handles query string escaping for RediSearch queries. Multi-word search terms must now use double quotes (`"`) instead of single quotes (`'`).

**Before (Jedis 5.2.0):**
[source,java]
----
SearchOperations<String> ops = modulesOperations.opsForSearch("myIndex");
SearchResult result = ops.search(new Query("@title:'hello world'"));
----

**After (Jedis 6.0.0):**
[source,java]
----
SearchOperations<String> ops = modulesOperations.opsForSearch("myIndex");
SearchResult result = ops.search(new Query("@title:\"hello world\""));
----

**Who is affected:**

* Users implementing custom repository methods that construct `Query` objects with Jedis
* Users directly using `SearchOperations` with string-based queries containing spaces

**Who is NOT affected:**

* Users only using Redis OM Spring's built-in repository query methods
* Users using Entity Streams API
* Users using `@Query` annotations (these are handled internally by Redis OM Spring)

=== Migration Steps

. Update your `pom.xml` or `build.gradle` to use Redis OM Spring 1.1.0
. If you have custom repository implementations using Jedis `Query` objects:
.. Review all custom query strings
.. Replace single quotes with double quotes around multi-word search terms
.. Test your custom queries thoroughly

=== Example Migration

Here's a complete example of migrating a custom repository method:

.Before (1.0.x)
[source,java]
----
@Override
public Optional<MyEntity> findByTitle(String title) {
    SearchOperations<String> ops = modulesOperations.opsForSearch(MyEntity.class.getName() + "Idx");
    SearchResult result = ops.search(new Query("@title:'" + title + "'"));  // <1>
    if (result.getTotalResults() > 0) {
        Document doc = result.getDocuments().get(0);
        return Optional.of(ObjectUtils.documentToEntity(doc, MyEntity.class, converter));
    }
    return Optional.empty();
}
----
<1> Single quotes around the title value

.After (1.1.0)
[source,java]
----
@Override
public Optional<MyEntity> findByTitle(String title) {
    SearchOperations<String> ops = modulesOperations.opsForSearch(MyEntity.class.getName() + "Idx");
    SearchResult result = ops.search(new Query("@title:\"" + title + "\""));  // <1>
    if (result.getTotalResults() > 0) {
        Document doc = result.getDocuments().get(0);
        return Optional.of(ObjectUtils.documentToEntity(doc, MyEntity.class, converter));
    }
    return Optional.empty();
}
----
<1> Double quotes around the title value

=== Testing Your Migration

After upgrading, ensure you test:

. All custom repository methods that use Jedis `Query` objects
. Any direct usage of `SearchOperations`
. Integration tests with multi-word search terms

The Redis OM Spring test suite includes comprehensive tests for query escaping. Refer to the test examples in the repository for best practices.
